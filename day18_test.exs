ExUnit.start()
defmodule Testing do
  use ExUnit.Case, async: true
  test "test_explode" do
    pairs = [
      {[[[[[9,8],1],2],3],4],
      [[[[0,9],2],3],4]},
      {[7,[6,[5,[4,[3,2]]]]],
      [7,[6,[5,[7,0]]]]},
      {[[6,[5,[4,[3,2]]]],1],
      [[6,[5,[7,0]]],3]},
      {[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]],
      [[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]},
      {[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]],
      [[3,[2,[8,0]]],[9,[5,[7,0]]]]}
    ]
    for {a,b} <- pairs do
      {true, snail_num, _la, _ra} = Snails.snail_explode(a, 0)
      assert snail_num == b
    end
  end

  test "test_addition" do
    #NOTE: snail_add is a reducer, so the left element is the to_process thing and the right the acumulator
    assert Snails.snail_add([1,1],[[[[4,3],4],4],[7,[[8,4],9]]]) == [[[[0,7],4],[[7,8],[6,0]]],[8,1]]
  end

  test "test_full_small" do
    added = [[1,1],
     [2,2],
     [3,3],
     [4,4]]
    |> Enum.reduce(&Snails.snail_add/2)
    assert added == [[[[1,1],[2,2]],[3,3]],[4,4]]
  end

  test "test_full_2" do
    added = [[1,1],
    [2,2],
    [3,3],
    [4,4],
    [5,5]]
    |> Enum.reduce(&Snails.snail_add/2)
    assert added == [[[[3,0],[5,3]],[4,4]],[5,5]]
  end

  test "test_full_3" do
    added = [[1,1],
    [2,2],
    [3,3],
    [4,4],
    [5,5],
    [6,6]]
    |> Enum.reduce(&Snails.snail_add/2)
    assert added == [[[[5,0],[7,4]],[5,5]],[6,6]]
  end

  test "test_full_large" do
    added = [[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]],
    [7,[[[3,7],[4,3]],[[6,3],[8,8]]]],
    [[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]],
    [[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]],
    [7,[5,[[3,8],[1,4]]]],
    [[2,[2,2]],[8,[8,1]]],
    [2,9],
    [1,[[[9,3],9],[[9,0],[0,7]]]],
    [[[5,[7,4]],7],1],
    [[[[4,2],2],6],[8,7]]]
    |> Enum.reduce(&Snails.snail_add/2)
    assert added == [[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]
  end

  test "test_magnitudes" do
    pairs = [
      {[[1,2],[[3,4],5]], 143},
      {[[[[0,7],4],[[7,8],[6,0]]],[8,1]], 1384},
      {[[[[1,1],[2,2]],[3,3]],[4,4]], 445},
      {[[[[3,0],[5,3]],[4,4]],[5,5]], 791},
      {[[[[5,0],[7,4]],[5,5]],[6,6]], 1137},
      {[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]], 3488}
    ]
    for {a,b} <- pairs do
      assert Snails.magnitude(a) == b
    end
  end

  test "final test" do
    input = [[[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]],
    [[[5,[2,8]],4],[5,[[9,9],0]]],
    [6,[[[6,2],[5,6]],[[7,6],[4,7]]]],
    [[[6,[0,7]],[0,9]],[4,[9,[9,0]]]],
    [[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]],
    [[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]],
    [[[[5,4],[7,7]],8],[[8,3],8]],
    [[9,3],[[9,9],[6,[4,9]]]],
    [[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]],
    [[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]]
    |> Enum.reduce(&Snails.snail_add/2)
    assert input == [[[[6,6],[7,6]],[[7,7],[7,0]]],[[[7,7],[7,7]],[[7,8],[9,9]]]]
    assert Snails.magnitude(input) == 4140
  end


end
